import pickle
from pandas.io import json
from pdfid.pdfid import PDFiDMain, get_fake_options, PDFiD2JSON, PDFiD
import pandas as pd


def scan_pdf_file(path):
    options = get_fake_options()
    options.json = True

    return PDFiDMain([path], options)['reports']


def predict(data):
    model = pickle.load(open("svm_model.sav", "rb"))
    scaler = pickle.load(open("standard_scaler.sav", "rb"))

    print(model)
    print(scaler)

    prediction = model.predict(scaler.transform(data))
    print(prediction)


if __name__ == "__main__":
    scanned_data = scan_pdf_file('corona2014.pdf')
    # scanned_data.pop("filename")
    # scanned_data.pop("/Colors > 2^24")
    # scanned_data.pop("version")

    # print(df)
    df = pd.read_json(json.dumps(scanned_data))
    df["header"] = pd.to_numeric(
        df["header"].str.replace('[^\d.]', ''), errors='coerce')
    df.drop(['filename', 'version', '/Colors > 2^24'],
            axis=1, inplace=True)
    predict(df)
    # print(test_head)
    # print(scanned_data)
